# socks5_route
此程序可以通过先进的算法为已有socks5代理， 做智能路由(智能分流)，
从而可以避免手动配置pac代理清单做静态分流， 静态清单的弊端就是部分网址不在清单中， 无法访问等！

## 工作原理
1. 需要监听一个本地socks5端口， 然后需要在您的系统中配置该代理
2. 出口需要指定一个已有的socks5代理， 如v2ray等！
3. 一条数据发送到程序坚挺的socks5代理后，进行数据解析
4. 尝试先直连目标服务器，如在若干秒内（可配置，默认1s）有数据返回，则认为可直连，不走代理
5. 如果在若干秒内（可配置，默认1s）无数据返回，则创建子线程用于通过代理连接目标服务器
6. 此时有两条链路同时访问目标服务器，若谁能先返回首帧数据(第一个512kb bytes)，便会使另一条链路close
    （此机制可以在充分利用直连链路的前提下， 测试那条链路速度快，尽可能使用最快的链路）
7. 当此请求确认链路后，会被记入临时路由表， 针对每个域名连续做两次上面的测试操作， 只有两次结果均为“代理”时，持久化到路由表为“代理”
    否则持久化为“直连”到路由表， 值得注意的是域名并非全域名，比如两次请求地址分别是 www.baidu.com, tieba.cn.baidu.com, 只视作一条baidu.com
8. 持久化到路由表的路由条目并非持久不更新，而是默认30分钟后过期，重新测试

## 使用方法
``` shell
./socks5_route 127.0.0.1:1081 127.0.0.1:1080 
./socks5_route 127.0.0.1:1081 127.0.0.1:1080 debug
./socks5_route 127.0.0.1:1081 127.0.0.1:1080 nodebug 1800 
./socks5_route 127.0.0.1:1081 127.0.0.1:1080 nodebug 1800 1000
```
> 127.0.0.1:1081: 此程序坚挺地址端口， 为socks5代理
> 127.0.0.1:1080: 现有的socks5代理客户端开放的端口
> debug: 打印日志数据
> 1800: 路由表过期时间，默认1800秒
> 1000: 直连请求发送后延迟多少毫秒尝试发送代理请求
